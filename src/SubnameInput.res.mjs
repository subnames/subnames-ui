// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Option from "@rescript/core/src/Core__Option.res.mjs";
import * as JsxRuntime from "react/jsx-runtime";

function isValidSubname(name) {
  var length = name.length;
  if (length === 0) {
    return [
            false,
            undefined
          ];
  }
  if (length < 3) {
    return [
            false,
            "Name is too short"
          ];
  }
  if (length > 32) {
    return [
            false,
            "Name is too long"
          ];
  }
  var validCharRegex = /^[a-zA-Z0-9-]+$/;
  var isValidFormat = validCharRegex.test(name);
  if (isValidFormat) {
    if (Caml_obj.equal(name[0], "-") || Caml_obj.equal(name[length - 1 | 0], "-")) {
      return [
              false,
              "Cannot start or end with hyphen"
            ];
    } else {
      return [
              true,
              undefined
            ];
    }
  } else {
    return [
            false,
            "Invalid characters"
          ];
  }
}

function SubnameInput(props) {
  var onValidChange = props.onValidChange;
  var match = React.useState(function () {
        return {
                value: "",
                isValid: false,
                errorMessage: undefined
              };
      });
  var setState = match[1];
  var state = match[0];
  var timeoutRef = React.useRef(undefined);
  var handleChange = function ($$event) {
    var newValue = $$event.target.value;
    setState(function (prev) {
          return {
                  value: newValue,
                  isValid: prev.isValid,
                  errorMessage: prev.errorMessage
                };
        });
    var timeout = timeoutRef.current;
    if (timeout !== undefined) {
      clearTimeout(Caml_option.valFromOption(timeout));
    }
    var timeout$1 = setTimeout((function () {
            var match = isValidSubname(newValue);
            var errorMessage = match[1];
            var isValid = match[0];
            setState(function (prev) {
                  return {
                          value: prev.value,
                          isValid: isValid,
                          errorMessage: errorMessage
                        };
                });
            onValidChange(newValue, isValid);
          }), 500);
    timeoutRef.current = Caml_option.some(timeout$1);
  };
  var handleClear = function (param) {
    setState(function (param) {
          return {
                  value: "",
                  isValid: false,
                  errorMessage: undefined
                };
        });
    onValidChange("", false);
  };
  var error = state.errorMessage;
  return JsxRuntime.jsx("div", {
              children: JsxRuntime.jsxs("div", {
                    children: [
                      JsxRuntime.jsxs("div", {
                            children: [
                              JsxRuntime.jsx("input", {
                                    className: "w-full px-6 py-4 text-2xl focus:outline-none",
                                    placeholder: "SEARCH FOR A NAME",
                                    type: "text",
                                    value: state.value,
                                    onChange: handleChange
                                  }),
                              JsxRuntime.jsxs("div", {
                                    children: [
                                      state.value !== "" ? JsxRuntime.jsx("button", {
                                              children: JsxRuntime.jsx("svg", {
                                                    children: JsxRuntime.jsx("path", {
                                                          d: "M18 6L6 18M6 6L18 18",
                                                          stroke: "#999999",
                                                          strokeLinecap: "round",
                                                          strokeLinejoin: "round",
                                                          strokeWidth: "2"
                                                        }),
                                                    height: "24",
                                                    width: "24",
                                                    fill: "none",
                                                    viewBox: "0 0 24 24",
                                                    xmlns: "http://www.w3.org/2000/svg"
                                                  }),
                                              className: "p-1 hover:bg-gray-100 rounded-full transition-colors",
                                              type: "button",
                                              onClick: handleClear
                                            }) : null,
                                      JsxRuntime.jsx("svg", {
                                            children: JsxRuntime.jsx("path", {
                                                  d: "M21 21L16.5 16.5M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z",
                                                  stroke: "#999999",
                                                  strokeLinecap: "round",
                                                  strokeLinejoin: "round",
                                                  strokeWidth: "2"
                                                }),
                                            height: "24",
                                            width: "24",
                                            fill: "none",
                                            viewBox: "0 0 24 24",
                                            xmlns: "http://www.w3.org/2000/svg"
                                          })
                                    ],
                                    className: "absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"
                                  })
                            ],
                            className: "relative"
                          }),
                      error !== undefined ? JsxRuntime.jsx("div", {
                              children: JsxRuntime.jsx("div", {
                                    children: error,
                                    className: "text-gray-600 text-lg"
                                  }),
                              className: "px-6 py-4"
                            }) : null
                    ],
                    className: "bg-white rounded-2xl shadow-lg overflow-hidden " + (
                      Core__Option.isSome(state.errorMessage) ? "divide-y" : ""
                    )
                  }),
              className: "w-full max-w-2xl"
            });
}

var make = SubnameInput;

export {
  make ,
}
/* react Not a pure module */
